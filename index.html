<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Toy Tale</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div id="toy-header">
      <img
        src="https://fontmeme.com/permalink/180719/67429e6afec53d21d64643101c43f029.png"
        alt="toy-header"
      />
    </div>

    <div class="container">
      <form class="add-toy-form">
        <h3>Create a toy!</h3>

        <input
          type="text"
          name="name"
          value=""
          placeholder="Enter a toy's name..."
          class="input-text"
        />
        <br />
        <input
          type="text"
          name="image"
          value=""
          placeholder="Enter a toy's image URL..."
          class="input-text"
        />
        <br />
        <input
          type="submit"
          name="submit"
          value="Create Toy"
          class="submit"
        />
      </form>
    </div>
    <p style="text-align:center">
      Andy needs your help! <button id="new-toy-btn">Add a new toy!</button>
    </p>

    <div id="toy-collection"></div>
    <script type="text/javascript" src="src/index.js">
      document.addEventListener('DOMContentLoaded', () => {
        const addBtn = document.querySelector('#new-toy-btn');
        const toyForm = document.querySelector('.container');
        let addToy = false;
  
        addBtn.addEventListener('click', () => {
          addToy = !addToy;
          if (addToy) {
            toyForm.style.display = 'block';
            toyForm.addEventListener('submit', event => {
              event.preventDefault();
              const name = event.target.name.value;
              const image = event.target.image.value;
  
              fetch('http://localhost:3000/toys', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  Accept: 'application/json',
                },
                body: JSON.stringify({
                  name,
                  image,
                  likes: 0,
                }),
              })
                .then(response => response.json())
                .then(newToy => {
                  renderToy(newToy);
                  event.target.reset();
                  toyForm.style.display = 'none';
                });
            });
          } else {
            toyForm.style.display = 'none';
          }
        });
  
        fetchToys();
  
        function fetchToys() {
          fetch('http://localhost:3000/toys')
            .then(response => response.json())
            .then(toys => {
              toys.forEach(toy => renderToy(toy));
            });
        }
  
        function renderToy(toy) {
          const toyCollection = document.getElementById('toy-collection');
  
          const card = document.createElement('div');
          card.className = 'card';
          card.id = toy.id;
  
          card.innerHTML = `
            <h2>${toy.name}</h2>
            <img src="${toy.image}" class="toy-avatar" />
            <p>${toy.likes} Likes</p>
            <button class="like-btn" id="${toy.id}">Like ❤️</button>
          `;
  
          const likeButton = card.querySelector('.like-btn');
          likeButton.addEventListener('click', () => likeToy(toy));
  
          toyCollection.appendChild(card);
        }
  
        function likeToy(toy) {
          const newLikes = toy.likes + 1;
  
          fetch(`http://localhost:3000/toys/${toy.id}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              Accept: 'application/json',
            },
            body: JSON.stringify({
              likes: newLikes,
            }),
          })
            .then(response => response.json())
            .then(updatedToy => {
              const card = document.getElementById(updatedToy.id);
              const likeElement = card.querySelector('p');
              likeElement.textContent = `${updatedToy.likes} Likes`;
            });
        }
      });
    </script>
</body>
</html>
